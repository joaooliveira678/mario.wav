<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Luta de Quadrados</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #eee;
    }
    canvas {
      display: block;
      background: #c4f0c5;
    }
  </style>
</head>
<body>
<canvas id="game" width="900" height="400"></canvas>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const groundY = 350;
  const gravity = 0.6;

  class Player {
    constructor(x, color, keys) {
      this.x = x;
      this.y = groundY - 50;
      this.width = 40;
      this.height = 50;
      this.color = color;
      this.dy = 0;
      this.grounded = false;
      this.health = 100;
      this.keys = keys;
      this.direction = 1;
      this.hasWaterGun = false;
    }

    move() {
      if (this.keys.left.pressed) this.x -= 4;
      if (this.keys.right.pressed) this.x += 4;

      // Gravidade
      this.dy += gravity;
      this.y += this.dy;

      // ChÃ£o
      if (this.y + this.height >= groundY) {
        this.y = groundY - this.height;
        this.dy = 0;
        this.grounded = true;
      } else {
        this.grounded = false;
      }

      // Pulo
      if (this.keys.up.pressed && this.grounded) {
        this.dy = -12;
      }

      // Limites da tela
      this.x = Math.max(0, Math.min(this.x, canvas.width - this.width));
    }

    draw() {
      ctx.fillStyle = this.color;
      ctx.fillRect(this.x, this.y, this.width, this.height);
    }

    attack(target) {
      const reach = 20;
      if (Math.abs(this.x - target.x) <= this.width + reach &&
          Math.abs(this.y - target.y) <= this.height) {
        target.health -= 10;
      }
    }
  }

  class WaterGun {
    constructor() {
      this.x = 30;
      this.y = groundY - 30;
      this.width = 20;
      this.height = 20;
      this.collected = false;
    }

    draw() {
      if (!this.collected) {
        ctx.fillStyle = 'lightblue';
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    }

    checkPickup(player) {
      if (!this.collected &&
          player.x < this.x + this.width &&
          player.x + player.width > this.x &&
          player.y < this.y + this.height &&
          player.y + player.height > this.y) {
        this.collected = true;
        player.hasWaterGun = true;
      }
    }
  }

  class Projectile {
    constructor(x, y, direction, color) {
      this.x = x;
      this.y = y;
      this.width = 10;
      this.height = 5;
      this.direction = direction;
      this.color = color;
      this.speed = 6;
    }

    move() {
      this.x += this.direction * this.speed;
    }

    draw() {
      ctx.fillStyle = this.color;
      ctx.fillRect(this.x, this.y, this.width, this.height);
    }

    hit(target) {
      return (
        this.x < target.x + target.width &&
        this.x + this.width > target.x &&
        this.y < target.y + target.height &&
        this.y + this.height > target.y
      );
    }
  }

  const keys1 = {
    left: { code: 'KeyA', pressed: false },
    right: { code: 'KeyD', pressed: false },
    up: { code: 'KeyW', pressed: false },
    attack: { code: 'KeyF' }
  };

  const keys2 = {
    left: { code: 'ArrowLeft', pressed: false },
    right: { code: 'ArrowRight', pressed: false },
    up: { code: 'ArrowUp', pressed: false },
    attack: { code: 'KeyL' }
  };

  const player1 = new Player(100, 'red', keys1);
  const player2 = new Player(700, 'blue', keys2);

  const waterGun = new WaterGun();
  const projectiles = [];

  function drawHealthBars() {
    ctx.fillStyle = 'red';
    ctx.fillRect(20, 20, player1.health * 2, 10);
    ctx.fillStyle = 'blue';
    ctx.fillRect(660, 20, player2.health * 2, 10);
  }

  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    player1.move();
    player2.move();

    player1.draw();
    player2.draw();
    drawHealthBars();

    waterGun.draw();
    waterGun.checkPickup(player1);
    waterGun.checkPickup(player2);

    // Projetos
    for (let i = projectiles.length - 1; i >= 0; i--) {
      const p = projectiles[i];
      p.move();
      p.draw();

      if (p.hit(player1) && p.color !== 'red') {
        player1.health -= 5;
        projectiles.splice(i, 1);
      } else if (p.hit(player2) && p.color !== 'blue') {
        player2.health -= 5;
        projectiles.splice(i, 1);
      } else if (p.x < 0 || p.x > canvas.width) {
        projectiles.splice(i, 1);
      }
    }

    // Verifica fim do jogo
    if (player1.health <= 0 || player2.health <= 0) {
      ctx.fillStyle = 'black';
      ctx.font = '40px Arial';
      const winner = player1.health <= 0 ? 'Jogador Azul venceu!' : 'Jogador Vermelho venceu!';
      ctx.fillText(winner, 250, 200);
      return;
    }

    requestAnimationFrame(gameLoop);
  }

  // Input
  document.addEventListener('keydown', (e) => {
    for (let k in keys1) if (keys1[k].code === e.code) keys1[k].pressed = true;
    for (let k in keys2) if (keys2[k].code === e.code) keys2[k].pressed = true;

    // Ataques
    if (e.code === keys1.attack.code) {
      if (player1.hasWaterGun) {
        projectiles.push(new Projectile(player1.x + 40, player1.y + 20, 1, 'red'));
      } else {
        player1.attack(player2);
      }
    }

    if (e.code === keys2.attack.code) {
      if (player2.hasWaterGun) {
        projectiles.push(new Projectile(player2.x - 10, player2.y + 20, -1, 'blue'));
      } else {
        player2.attack(player1);
      }
    }
  });

  document.addEventListener('keyup', (e) => {
    for (let k in keys1) if (keys1[k].code === e.code) keys1[k].pressed = false;
    for (let k in keys2) if (keys2[k].code === e.code) keys2[k].pressed = false;
  });

  gameLoop();
</script>
</body>
</html>
